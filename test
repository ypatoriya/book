import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Container, Button, Form, FormGroup, FormControl, FormLabel } from 'react-bootstrap';
import axios from 'axios';
import PublicLinkModal from './LinkModal';
import { Navigate } from 'react-router-dom';

const CreateFormPage = () => {
    const [title, setTitle] = useState('');
    const [description, setDescription] = useState('');
    const [questions, setQuestions] = useState([]);
    const [showModal, setShowModal] = useState(false);
    const [publicLink, setPublicLink] = useState('');

    const navigate = useNavigate()

    const handleCloseModal = () => {
        setShowModal(false);
    };

    const handleAddQuestion = () => {
        setQuestions([...questions, { type: 'text', value: '', options: [] }]);
        localStorage.setItem('questions', JSON.stringify([...questions, { type: 'text', value: '', options: [] }]));
    };

    const handleDeleteQuestion = (index) => {
        const newQuestions = [...questions];
        newQuestions.splice(index, 1);
        setQuestions(newQuestions);
    };

    const handleTitleChange = (event) => {
        setTitle(event.target.value);
        localStorage.setItem('title', title)
    };

    const handleDescriptionChange = (event) => {
        setDescription(event.target.value);
        localStorage.setItem('description', description)
    };

    const handleQuestionChange = (event, index) => {
        const newQuestions = [...questions];
        newQuestions[index].value = event.target.value;
        setQuestions(newQuestions);
        localStorage.setItem('question', questions)
    };

    const handleTypeChange = (event, index) => {
        const newQuestions = [...questions];
        newQuestions[index].type = event.target.value;
        setQuestions(newQuestions);
    };

    const handleAddRadio = (index) => {
        const newQuestions = [...questions];
        newQuestions[index].radios = newQuestions[index].options || [];
        newQuestions[index].options.push('');
        setQuestions(newQuestions);
    };

    const handleAddCheckbox = (index) => {
        const newQuestions = [...questions];
        newQuestions[index].checkboxes = newQuestions[index].options || [];
        newQuestions[index].options.push('');
        setQuestions(newQuestions);
    };

    const handleRemoveRadio = (questionIndex, radioIndex) => {
        const newQuestions = [...questions];
        newQuestions[questionIndex].radios.splice(radioIndex, 1);
        setQuestions(newQuestions);
    };

    const handleRemoveCheckbox = (questionIndex, checkboxIndex) => {
        const newQuestions = [...questions];
        newQuestions[questionIndex].checkboxes.splice(checkboxIndex, 1);
        setQuestions(newQuestions);
    };

    const handleSubmit = async (event) => {
        event.preventDefault();

        try {
            const headers = {
                'Authorization': localStorage.getItem('accessToken')
            }

            const response = await axios.post('http://localhost:5000/createForm', {
                title,
                description,
                questions
            },
            {
                headers: {
                    'Authorization': localStorage.getItem('accessToken') 
                  }
            });

            if (response.status === 200) {
                console.log('Form Created.');
                navigate('/dashboard')
            } else {
                console.log(`Unexpected status code: ${response.status}`);
            }
        } catch (error) {
            console.error('Error creating form:', error.message || JSON.stringify(error));
        }
    };

    return (
        <Container>
            <h1 className='mt-5 mb-5'><b>Create Form</b></h1>
            <Form onSubmit={handleSubmit}>
                <FormGroup>
                    <FormLabel><h4><b>Title</b></h4></FormLabel>
                    <FormControl type="text" value={title} onChange={handleTitleChange} placeholder="Form Title" />
                    <FormControl className='mt-3' type="text" value={description} onChange={handleDescriptionChange} placeholder="Description" />
                </FormGroup>

                {questions.map((question, index) => (
                    <FormGroup key={index}>
                        <FormLabel><h5 className='mt-3'>Question {index + 1}</h5></FormLabel>
                        <FormControl type="text" value={question.value} onChange={(event) => handleQuestionChange(event, index)} placeholder="Enter question" />
                        <Form.Control as="select" value={question.type} onChange={(event) => handleTypeChange(event, index)} className="mt-2">
                            <option value="text">Text</option>
                            <option value="radio">Radio</option>
                            <option value="checkbox">Checkbox</option>
                        </Form.Control>

                        {question.type === 'radio' && (
                            <div>
                                {question.radios && question.radios.map((radio, radioIndex) => (
                                    <div key={radioIndex} className="mt-2">
                                        <FormControl
                                            type="text"
                                            value={radio}
                                            onChange={(event) => {
                                                const newQuestions = [...questions];
                                                newQuestions[index].radios[radioIndex] = event.target.value;
                                                setQuestions(newQuestions);
                                            }}
                                            placeholder={`Radio ${radioIndex + 1}`}
                                        />
                                        <Button
                                            variant="danger"
                                            onClick={() => handleRemoveRadio(index, radioIndex)}
                                            className="ml-2"
                                        >
                                            Remove
                                        </Button>
                                    </div>
                                ))}
                                <Button
                                    variant="primary"
                                    onClick={() => handleAddRadio(index)}
                                    className="mt-2"
                                >
                                    Add Radio
                                </Button>
                            </div>
                        )}

                        {question.type === 'checkbox' && (
                            <div>
                                {question.checkboxes && question.checkboxes.map((checkbox, checkboxIndex) => (
                                    <div key={checkboxIndex} className="mt-2">
                                        <FormControl
                                            type="text"
                                            value={checkbox}
                                            onChange={(event) => {
                                                const newQuestions = [...questions];
                                                newQuestions[index].checkboxes[checkboxIndex] = event.target.value;
                                                setQuestions(newQuestions);
                                            }}
                                            placeholder={`Checkbox ${checkboxIndex + 1}`}
                                        />
                                        <Button
                                            variant="danger"
                                            onClick={() => handleRemoveCheckbox(index, checkboxIndex)}
                                            className="ml-2"
                                        >
                                            Remove
                                        </Button>
                                    </div>
                                ))}
                                <Button
                                    variant="primary"
                                    onClick={() => handleAddCheckbox(index)}
                                    className="mt-2"
                                >
                                    Add Checkbox
                                </Button>
                            </div>
                        )}

                        <Button variant="danger" onClick={() => handleDeleteQuestion(index)} className="mt-2">Delete</Button>
                    </FormGroup>
                ))}

                <Button className="mt-2 mr-2" variant="primary" onClick={handleAddQuestion}>Add Question</Button>
                <Button variant="success" type="submit" className="mt-2 ml-2">Submit</Button>

                <PublicLinkModal
                    show={showModal}
                    handleClose={handleCloseModal}
                    publicLink={publicLink}
                />
            </Form>
        </Container>
    );
};

export default CreateFormPage;

on each button click i want to store data in local Storage, when i click edit button from dahsboard all the data will be stored in local storage and then i will get the data from local storage and then i will show the data in the form and then submit to the database. create new react page for this, just like this create form page.
